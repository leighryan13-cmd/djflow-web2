<!doctype html>
<html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>DJFlow (Web)</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%2319a7ff'/></svg>">
<style>
:root{--bg:#0a0a0a;--card:#121316;--border:#22252d;--text:#e8eef6;--dim:#9aa7b2;--primary:#19a7ff;--radius:16px}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto}
.wrap{max-width:980px;margin:0 auto;padding:16px}.row{display:flex;gap:12px;align-items:center}.card{background:#121316;border:1px solid #22252d;border-radius:16px;padding:16px}
button{border:1px solid #22252d;background:#19a7ff;color:#00121f;padding:10px 16px;border-radius:12px;font-weight:800;cursor:pointer}
button.ghost{background:transparent;color:#e8eef6}input,textarea{background:#0b0e13;color:#e8eef6;border:1px solid #22252d;border-radius:12px;padding:10px;height:42px}
.muted{color:#9aa7b2}.item{border:1px solid #22252d;border-radius:12px;padding:10px;display:flex;justify-content:space-between;align-items:center;margin-top:8px}
.qr{background:#fff;padding:8px;border-radius:12px;display:inline-block}.tag{font-size:12px;padding:2px 6px;border-radius:6px;border:1px solid #22252d;color:#9aa7b2;margin-left:8px}
</style>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.4/build/qrcode.min.js"></script>
</head>
<body><div id="app"></div>
<script>
const {useState,useEffect,useRef}=React;
const LS={get:k=>{try{return JSON.parse(localStorage.getItem(k)||'null')}catch{return null}},set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))};
const uid=()=>Math.random().toString(36).slice(2); const genCode=()=>String(Math.floor(100000+Math.random()*900000));
function getEvents(){return LS.get('events')||[]}function saveEvents(a){LS.set('events',a)}
function getMessages(){return LS.get('messages')||[]}function saveMessages(a){LS.set('messages',a)}
function useHash(){const [h,setH]=useState(location.hash||'#/');useEffect(()=>{const f=()=>setH(location.hash||'#/');addEventListener('hashchange',f);return()=>removeEventListener('hashchange',f)},[]);return h.replace(/^#/,'')}
const nav=(to)=>location.hash=to;
async function searchITunes(q){const r=await fetch('https://itunes.apple.com/search?media=music&entity=song&limit=15&term='+encodeURIComponent(q));const j=await r.json();return(j.results||[]).map(x=>({title:x.trackName,artist:x.artistName,platform:'itunes',id:String(x.trackId),url:x.trackViewUrl}))}
async function searchSpotify(q){const r=await fetch('/api/spotify-search?q='+encodeURIComponent(q));if(!r.ok) throw new Error('Spotify failed');return await r.json()}
async function searchAll(q){let out=[];try{out=out.concat(await searchITunes(q))}catch{}try{out=out.concat(await searchSpotify(q))}catch{}return out}
function QR({text,size=200}){const ref=useRef(null);useEffect(()=>{if(!ref.current)return;ref.current.innerHTML='';QRCode.toCanvas(text,{width:size,margin:1},(e,c)=>{if(!e&&ref.current)ref.current.appendChild(c)})},[text,size]);return React.createElement('div',{className:'qr',ref})}
function Dashboard(){const [events,setEvents]=useState(getEvents());function create(){const ev={id:uid(),code:genCode(),name:'New Event',date:new Date().toISOString(),venue:'',mustPlay:[],niceToHave:[],doNotPlay:[],timeline:[]};const arr=[ev,...events];setEvents(arr);saveEvents(arr);nav('/event/'+ev.id)}return React.createElement('div',{className:'wrap'},React.createElement('div',{className:'row',style:{justifyContent:'space-between'}},[React.createElement('h1',{key:1},'Your Events'),React.createElement('button',{key:2,onClick:create},'New Event')]),events.length?events.map(e=>React.createElement('div',{key:e.id,className:'card'},React.createElement('h3',null,e.name),React.createElement('div',{className:'muted'},new Date(e.date).toDateString()+' • '+(e.venue||'TBA')),React.createElement('div',{className:'row',style:{gap:'8px',marginTop:'8px'}},React.createElement('button',{onClick:()=>nav('/event/'+e.id)},'Open'),React.createElement('button',{className:'ghost',onClick:()=>nav('/client-portal/'+e.code)},'Client Link')))):React.createElement('div',{className:'muted'},'No events yet.'))}
function EventPage({id}){const [ev,setEv]=useState(null),[q,setQ]=useState(''),[res,setRes]=useState([]),[t,setT]=useState('18:00'),[ttl,setTtl]=useState(''),[nt,setNt]=useState('');useEffect(()=>{setEv((getEvents().find(x=>x.id===id))||null)},[id]);if(!ev)return React.createElement('div',{className:'wrap'},React.createElement('div',{className:'card'},'Event not found'));const link=location.origin+'/#/client?code='+ev.code;function addSong(list,label){const all=getEvents();const up=all.map(x=>x.id===ev.id?{...x,[list]:[...x[list],label]}:x);saveEvents(up);setEv(up.find(x=>x.id===ev.id))}function addTL(){const all=getEvents();const up=all.map(x=>x.id===ev.id?{...x,timeline:[...x.timeline,{id:uid(),time:t,title:ttl,notes:nt}]}:x);saveEvents(up);setEv(up.find(x=>x.id===ev.id));setTtl('');setNt('')}const msgs=getMessages().filter(m=>m.event_id===ev.id);function sendDJ(){const i=document.getElementById('chat-input');const text=(i?.value||'').trim();if(!text)return;const all=getMessages();all.push({id:uid(),event_id:ev.id,text, sender:'dj'});saveMessages(all);i.value='';render()}return React.createElement('div',{className:'wrap'},React.createElement('h1',null,ev.name),React.createElement('div',{className:'muted'},new Date(ev.date).toDateString()+' • '+(ev.venue||'TBA')),React.createElement('div',{className:'row',style:{gap:'8px',marginTop:'8px'}},React.createElement('div',null,'Code: '+ev.code),React.createElement('button',{onClick:()=>{navigator.clipboard?.writeText(link);alert('Link copied')}},'Copy Link'),React.createElement('button',{className:'ghost',onClick:()=>nav('/client-portal/'+ev.code)},'Open Client Portal')),React.createElement('div',{style:{marginTop:'12px'}},React.createElement(QR,{text:link,size:200})),React.createElement('div',{className:'card',style:{marginTop:'12px'}},React.createElement('h3',null,'Music Search (iTunes + Spotify)'),React.createElement('div',{className:'row'},React.createElement('input',{style:{flex:1},placeholder:'Search songs',value:q,onInput:e=>setQ(e.target.value)}),React.createElement('button',{onClick:async()=>setRes(await searchAll(q))},'Search')),res.map((t,i)=>React.createElement('div',{key:i,className:'item'},React.createElement('div',null,t.artist+' — '+t.title,React.createElement('span',{className:'tag'},t.platform||'unknown')),React.createElement('button',{className:'ghost',onClick:()=>addSong('niceToHave',t.artist+' — '+t.title)},'Add (Nice)')))),React.createElement('div',{className:'card',style:{marginTop:'12px'}},React.createElement('h3',null,'Timeline'),React.createElement('div',{className:'row'},React.createElement('input',{placeholder:'Time',value:t,onInput:e=>setT(e.target.value)}),React.createElement('input',{style:{flex:1},placeholder:'Title',value:ttl,onInput:e=>setTtl(e.target.value)})),React.createElement('textarea',{style:{marginTop:'8px'},rows:3,placeholder:'Notes',value:nt,onInput:e=>setNt(e.target.value)}),React.createElement('div',{style:{height:'8px'}}),React.createElement('button',{onClick:addTL},'Add to timeline'),ev.timeline.map(item=>React.createElement('div',{key:item.id,className:'item'},React.createElement('div',null,item.time+' — '+item.title),item.notes?React.createElement('div',{className:'muted'},item.notes):null))),React.createElement('div',{className:'card',style:{marginTop:'12px'}},React.createElement('h3',null,'Chat'),msgs.map(m=>React.createElement('div',{key:m.id,className:'item '+(m.sender==='dj'?'right':'')},m.text)),React.createElement('div',{className:'row',style:{marginTop:'8px'}},React.createElement('input',{id:'chat-input',style:{flex:1},placeholder:'Type a message…'}),React.createElement('button',{onClick:sendDJ},'Send'))))}
function ClientJoin(){const [code,setCode]=useState(new URL(location.href).searchParams.get('code')||'');return React.createElement('div',{className:'wrap'},React.createElement('h1',null,'Join Event'),React.createElement('div',{className:'card',style:{marginTop:'12px'}},React.createElement('div',{className:'row'},React.createElement('input',{style:{flex:1},placeholder:'Enter your code',value:code,onInput:e=>setCode(e.target.value)}),React.createElement('button',{onClick:()=>code&&nav('/client-portal/'+code)},'Open Portal'))))}
function ClientPortal({code}){const [ev,setEv]=useState(null),[song,setSong]=useState(''),[msg,setMsg]=useState(''),[msgs,setMsgs]=useState([]);useEffect(()=>{const e=getEvents().find(x=>x.code===code);setEv(e||null);setMsgs(getMessages().filter(m=>m.event_id===(e?e.id:'')))},[code]);if(!ev)return React.createElement('div',{className:'wrap'},React.createElement('div',{className:'card'},'Event not found'));function submit(){if(!song.trim())return;const all=getEvents();const up=all.map(x=>x.id===ev.id?{...x,niceToHave:[...x.niceToHave,song.trim()]}:x);saveEvents(up);setSong('');alert('Thanks!')}function send(){if(!msg.trim())return;const all=getMessages();const m={id:uid(),event_id:ev.id,text:msg.trim(),sender:'client'};all.push(m);saveMessages(all);setMsgs([...msgs,m]);setMsg('')}return React.createElement('div',{className:'wrap'},React.createElement('h1',null,ev.name),React.createElement('div',{className:'card',style:{marginTop:'12px'}},React.createElement('h3',null,'Request a Song'),React.createElement('div',{className:'row'},React.createElement('input',{style:{flex:1},placeholder:'Artist - Title',value:song,onInput:e=>setSong(e.target.value)}),React.createElement('button',{onClick:submit},'Submit'))),React.createElement('div',{className:'card',style:{marginTop:'12px'}},React.createElement('h3',null,'Chat'),msgs.map(m=>React.createElement('div',{key:m.id,className:'item'},m.text)),React.createElement('div',{className:'row',style:{marginTop:'8px'}},React.createElement('input',{style:{flex:1},placeholder:'Say hi…',value:msg,onInput:e=>setMsg(e.target.value)}),React.createElement('button',{onClick:send},'Send'))))}
function App(){const r=useHash();const p=r.split('/');if(r.startsWith('/event/'))return React.createElement(EventPage,{id:p[2]});if(r.startsWith('/client-portal/'))return React.createElement(ClientPortal,{code:p[2]});if(r.startsWith('/client'))return React.createElement(ClientJoin);return React.createElement(Dashboard)}
ReactDOM.createRoot(document.getElementById('app')).render(React.createElement(App));
</script></body></html>
